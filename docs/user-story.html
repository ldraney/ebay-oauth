<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBay OAuth â€” User Story</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; line-height: 1.6; color: #1a1a1a; }
        h1 { border-bottom: 2px solid #333; padding-bottom: 0.5rem; }
        h2 { margin-top: 2rem; color: #333; }
        code { background: #f4f4f4; padding: 0.2rem 0.4rem; border-radius: 3px; font-size: 0.9em; }
        pre { background: #f4f4f4; padding: 1rem; border-radius: 5px; overflow-x: auto; }
        pre code { background: none; padding: 0; }
        blockquote { border-left: 3px solid #ccc; margin: 1rem 0; padding: 0.5rem 1rem; color: #555; background: #f9f9f9; }
        .scenario { background: #f0f7ff; border: 1px solid #d0e3f7; border-radius: 5px; padding: 1rem; margin: 1rem 0; }
    </style>
</head>
<body>
    <h1>User Story</h1>

    <h2>Who</h2>
    <p>A developer building tools that interact with the eBay API on behalf of a seller (e.g., an MCP server for AI-powered listing).</p>

    <h2>Problem</h2>
    <p>eBay's OAuth Authorization Code Grant flow requires:</p>
    <ol>
        <li>A publicly accessible HTTPS endpoint to receive the callback</li>
        <li>Understanding eBay's specific OAuth quirks (Base64-encoded credentials, scope formatting, sandbox vs production URLs)</li>
        <li>Manual token exchange and refresh logic</li>
    </ol>
    <p>This is a one-time setup task that blocks all other development. Every eBay API project hits this wall first.</p>

    <h2>Desired Experience</h2>
    <div class="scenario">
        <pre><code>$ pip install ebay-oauth
$ ebay-oauth setup</code></pre>
        <p>The CLI:</p>
        <ol>
            <li>Asks for client_id, client_secret, and environment (sandbox/production)</li>
            <li>Spins up a temporary local server or deploys a callback handler to fly.io</li>
            <li>Opens the browser to eBay's consent page</li>
            <li>Catches the callback, exchanges the code for tokens</li>
            <li>Prints the refresh token and optionally writes it to a <code>.env</code> file</li>
        </ol>
    </div>
    <p>From that point forward, the developer has a long-lived refresh token (18 months) and never thinks about OAuth again until it expires.</p>

    <h2>Secondary Use: Library</h2>
    <pre><code>from ebay_oauth import EbayOAuthClient

client = EbayOAuthClient(
    client_id="...",
    client_secret="...",
    refresh_token="...",
    environment="sandbox"  # or "production"
)

# Always returns a valid access token (auto-refreshes if expired)
token = client.get_access_token()</code></pre>

    <h2>Success Criteria</h2>
    <ul>
        <li><code>pip install ebay-oauth</code> works</li>
        <li><code>ebay-oauth setup</code> gets a refresh token with minimal friction</li>
        <li>Token auto-refresh works transparently</li>
        <li>Works with both sandbox and production eBay environments</li>
    </ul>
</body>
</html>
